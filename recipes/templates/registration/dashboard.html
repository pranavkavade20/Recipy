{% extends 'base.html' %}
{% load static %}

{% block title %}RecipeBoard | Recipy{% endblock %} 

{% block content %}
<div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8 bg-stone-50 dark:bg-gray-950 transition-colors duration-500">
    
    <div class="max-w-7xl mx-auto bg-white dark:bg-gray-900 shadow-2xl rounded-[2rem] overflow-hidden border border-stone-100 dark:border-gray-800">

        <div class="relative bg-gradient-to-r from-orange-50 to-orange-100 dark:from-gray-800 dark:to-gray-750 px-6 py-10 md:px-10 border-b border-orange-100 dark:border-gray-700">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 relative z-10">
                <div class="flex items-center gap-5">
                    <div class="p-3 bg-white dark:bg-gray-700 rounded-2xl shadow-sm text-orange-500 ring-1 ring-orange-100 dark:ring-gray-600">
                        <svg class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl font-extrabold text-gray-900 dark:text-white tracking-tight">Your RecipeBoard</h1>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Manage, edit, and track the recipes you've shared.</p>
                    </div>
                </div>
                
                <a href="{% url 'add_recipe' %}" class="group inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white text-sm font-bold rounded-xl hover:shadow-lg hover:shadow-orange-500/30 hover:-translate-y-0.5 transition-all duration-300">
                    <svg class="w-5 h-5 mr-2 transition-transform group-hover:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                    Add New Recipe
                </a>
            </div>
            <div class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-orange-200/20 to-transparent pointer-events-none"></div>
        </div>
        
        <div class="p-6 md:p-10">
            <div class="flex items-center justify-between mb-6">
                <h4 class="text-xl font-bold text-gray-800 dark:text-gray-200 flex items-center gap-2">
                    <span class="w-2 h-8 bg-orange-500 rounded-full"></span>
                    Contributed Recipes
                </h4>
                <div class="text-sm font-medium px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-lg text-gray-600 dark:text-gray-300">
                    Total: <span class="text-orange-600 dark:text-orange-400 font-bold">{{ user.recipes.count }}</span>
                </div>
            </div>
            
            <div class="relative overflow-hidden rounded-2xl border border-gray-100 dark:border-gray-700 shadow-sm">
                <div class="overflow-x-auto custom-scrollbar max-h-[60vh]">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-50 dark:bg-gray-800/80 text-gray-500 dark:text-gray-400 text-xs uppercase font-bold tracking-wider sticky top-0 z-10 backdrop-blur-md">
                            <tr>
                                <th class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">Preview</th>
                                <th class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">Recipe Name</th>
                                <th class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">Type</th>
                                <th class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 w-1/3">Description</th>
                                <th class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100 dark:divide-gray-700 bg-white dark:bg-gray-800">
                            {% for recipe in user.recipes.all %}
                            <tr class="group hover:bg-orange-50/50 dark:hover:bg-gray-700/50 transition-colors duration-200">
                                
                                <td class="px-6 py-4">
                                    {% if recipe.receipe_image %}
                                    <div class="h-14 w-14 rounded-xl overflow-hidden shadow-sm border border-gray-100 dark:border-gray-600 group-hover:scale-110 transition-transform duration-300">
                                        <img src="{{ recipe.receipe_image.url }}" alt="{{ recipe.receipe_name }}" class="h-full w-full object-cover">
                                    </div>
                                    {% else %}
                                    <div class="h-14 w-14 rounded-xl bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-400">
                                        <span class="text-[10px] font-bold">NO IMG</span>
                                    </div>
                                    {% endif %}
                                </td>
                                
                                <td class="px-6 py-4">
                                    <div class="text-sm font-bold text-gray-900 dark:text-white group-hover:text-orange-600 dark:group-hover:text-orange-400 transition-colors">{{ recipe.receipe_name }}</div>
                                </td>
                                
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium border
                                        {% if recipe.receipe_type == 'Vegetarian' %} bg-emerald-50 text-emerald-700 border-emerald-100 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800
                                        {% elif recipe.receipe_type == 'Non Vegeterian' %} bg-rose-50 text-rose-700 border-rose-100 dark:bg-rose-900/30 dark:text-rose-400 dark:border-rose-800
                                        {% else %} bg-gray-50 text-gray-600 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600
                                        {% endif %}">
                                        {{ recipe.receipe_type }}
                                    </span>
                                </td>
                                
                                <td class="px-6 py-4">
                                    <div class="text-sm text-gray-600 dark:text-gray-400 truncate max-w-[200px] cursor-help border-b border-dotted border-gray-300"
                                         onmouseenter="showTooltip(this, `{{ recipe.receipe_description|escapejs }}`)"
                                         onmouseleave="hideTooltip()">
                                        {{ recipe.receipe_description }}
                                    </div>
                                </td>

                                <td class="px-6 py-4 text-center">
                                    <button class="text-gray-400 hover:text-blue-500 transition-colors p-1.5 rounded-full hover:bg-blue-50 dark:hover:bg-gray-700 mx-1">
                                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                    </button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="px-6 py-16 text-center">
                                    <div class="flex flex-col items-center justify-center">
                                        <div class="w-20 h-20 bg-orange-50 dark:bg-gray-800 rounded-full flex items-center justify-center text-orange-200 dark:text-orange-900/40 mb-4">
                                            <svg class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Your board is empty</h3>
                                        <a href="{% url 'add_recipe' %}" class="mt-4 px-6 py-2.5 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-bold shadow-lg shadow-orange-500/30">
                                            Create First Recipe
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="mt-8 flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                <a href="{% url 'home' %}" class="inline-flex items-center justify-center px-6 py-3 border border-gray-200 dark:border-gray-600 shadow-sm text-base font-medium rounded-xl text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200">
                    Back to Home
                </a>
            </div>

        </div>
    </div>
</div>

<div id="global-tooltip" class="fixed invisible z-[9999] max-w-xs w-auto bg-gray-900 dark:bg-gray-700 text-white text-xs rounded-xl p-3 shadow-xl pointer-events-none transition-opacity duration-200 opacity-0 transform -translate-x-1/2">
    </div>

<script>
    const tooltip = document.getElementById('global-tooltip');

    function showTooltip(element, text) {
        // Set content
        tooltip.textContent = text;
        
        // Calculate Position
        const rect = element.getBoundingClientRect();
        
        // Position it nicely above the element
        // (rect.top - height) puts it above. 
        // We add some buffer (-12px) for spacing.
        // We center it horizontally relative to the cell (rect.left + rect.width/2)
        
        tooltip.style.top = (rect.top - 10) + 'px'; // Initial pos for calculation
        tooltip.classList.remove('invisible');
        
        // We need to wait for the element to render to get its height
        requestAnimationFrame(() => {
            const tooltipHeight = tooltip.offsetHeight;
            tooltip.style.top = (rect.top - tooltipHeight - 10) + 'px';
            tooltip.style.left = (rect.left + (rect.width / 2)) + 'px';
            tooltip.classList.remove('opacity-0');
        });
    }

    function hideTooltip() {
        tooltip.classList.add('opacity-0');
        // Wait for transition to finish before hiding
        setTimeout(() => {
            tooltip.classList.add('invisible');
        }, 200);
    }
</script>

<style>
.custom-scrollbar::-webkit-scrollbar {
    height: 8px;
    width: 8px;
}
.custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #cbd5e1;
    border-radius: 20px;
    border: 3px solid transparent;
    background-clip: content-box;
}
.dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #4b5563;
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #94a3b8;
}
</style>

{% endblock %}